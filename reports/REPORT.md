# Отчёт: гипотезы, EDA-выводы и план экспериментов

## 1. Продуктовые гипотезы
- **H1. Velocity-риск.** Высокая активность в последние 60 минут (`last_hour_activity.*`) коррелирует с ростом мошенничества.  
  **Проверка:** бининг по квантилям, PR-AUC uplift при добавлении velocity-фичей.  
  **Ценность:** триггеры для step-up (3DS/SCA), лимиты.

- **H2. Риск каналов и устройств.** Транзакции без физического присутствия карты (`is_card_present=False`), через web/mobile, с редкими `device_fingerprint` — выше риск.  
  **Проверка:** Fraud rate by channel/device; SMOTE не применять, использовать class_weight/thresholding.  
  **Ценность:** device binding, MFA, таргетированная фрикция.

- **H3. Cross-border/вне домашней страны.** `is_outside_home_country=True`, разрыв часовых поясов, необычная валюта — риск выше.  
  **Проверка:** CFR (card-present vs not) × cross-border; временные окна по часовым поясам.  
  **Ценность:** динамические лимиты/рутинги на ручную проверку.

- **H4. Категории вендоров.** `is_high_risk_vendor=True` и отдельные `vendor_category`/`vendor_type` несут повышенный риск.  
  **Проверка:** Target encoding/WOE, контроль утечек; uplift PR-AUC в блендинге с другими факторами.  
  **Ценность:** правила allow/deny-листов и адаптивные пороги.

## 2. Технические гипотезы
- **T1. Конвертация сумм в USD** стабилизирует коэффициенты и улучшает переносимость порогов: `amount_usd = amount / rate[currency]`.  
  **Валидация:** сравнение PR-AUC до/после нормализации; PSI/JS-дрифт по суммам.

- **T2. Временное разбиение.** Time-based split даёт более реалистичную оценку; k-fold по времени (Purged CV).  
  **Валидация:** сравнение Hold-out vs TimeSeriesSplit.

- **T3. Графовые признаки.** Компоненты связности по `device_fingerprint`, `ip_address`, `card_number` выявляют кластеры мошенников.  
  **Валидация:** добавление degree/triangle-count/community-id; оценка uplift.

- **T4. Калибровка и порог.** CalibratedClassifierCV/Isotonic. Выбор порога под Precision≥0.9 или Cost-sensitive.  
  **Валидация:** PR-кривая, cost curve, подбор threshold.

- **T5. Мониторинг в проде.** Drift мониторинг (PSI), чанк-метрики, алерты. Champion/Challenger стратегия.

## 3. Риски качества данных
- Дубликаты `transaction_id`; рассинхрон валют и дат; редкие категории с <N наблюдений; утечки меток через признаки.
- Обработка: дедуп, приведение часовых поясов, каппинг экстремумов, агрегации на клиента/девайс, hashing trick для high-cardinality.

## 4. План экспериментов
1. **EDA & нормализация валют** → baseline LogisticRegression/LightGBM.  
2. **Временная валидация + калибровка**.  
3. **Графовые признаки (MVP)** на device/ip/card.  
4. **Подбор порога под бизнес-ограничения** (Precision ≥ 0.9).  
5. **Отчёт и презентация** с бизнес-кейсами и оценкой экономии.

## 5. Метрики для отчёта
- PR-AUC (основная), ROC-AUC, Recall@P=0.9, Precision@Recall=0.8, Lift@k.  
- Бизнес: предотвращённые потери (USD), % трафика в ручную проверку, среднее время ответа.